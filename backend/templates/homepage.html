<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlas</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* * General body styling.
         * Sets the background color, font, and text color for the page.
         * Uses flexbox to center the main content.
        */
        body {
            cursor: auto;
            background-color: #000;
            color: #29ddf5;
            font-family: 'Space Grotesk', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* * Styling for the new top header.
         * Positions it at the top and adds the glowing/blinking animation.
        */
     
.top-header {
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 28px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 3px;
    font-family: 'Orbitron', sans-serif;
    color: #030f33; /* Dark Blue text */
    text-shadow: 0 0 12px rgba(188, 226, 231, 0.705),
                 0 0 28px rgba(190, 245, 245, 0.671),
                 0 0 46px rgba(194, 233, 233, 0.76);
    animation: cyber-glitch 2s infinite;
}

/* Glitch keyframes */
@keyframes cyber-glitch {
  0% { transform: translateX(-50%) skew(0deg); }
  10% { transform: translateX(-50%) skew(10deg); }
  12% { transform: translateX(-50%) skew(-10deg); }
  15% { transform: translateX(-50%) skew(0deg); }
  55% { opacity: 1; }
  56% { opacity: 0.6; }
  57% { opacity: 1; }
  100% { transform: translateX(-50%) skew(0deg); }
}

        /* * Background text styling.
        */
        .background-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 35vw;
            font-weight: 700;
            color: #000000; /* solid black fill so smoke is behind text */
            -webkit-text-stroke: 0.25px #fff; /* extremely thin white border */
            z-index: 1;
            pointer-events: none; /* Allows clicking through the text */
            user-select: none; /* Prevents text selection */
            letter-spacing: -0.02em;
        }
        
        .background-text::after {
            content: 'ATLAS';
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(0,0,0,0) 70%, rgba(0,0,0,1) 100%);
            -webkit-mask-image: linear-gradient(to bottom, white 70%, transparent 100%);
            mask-image: linear-gradient(to bottom, white 70%, transparent 100%);
        }

        /* * Main container for the interactive content.
        */
        .container {
            position: relative;
            z-index: 2;
            text-align: center;
            padding: 20px;
            width: 100%;
            max-width: 620px;
        }

        /* * Styling for the main title "ATLAS".
        */
        .title {
            font-size: 72px;
            font-weight: 700; /* Bolder text */
            margin-bottom: 8px;
        }
        
        /* * Styling for the subtitle.
        */
        .subtitle {
            font-size: 18px;
            color: #a0a0a0;
            margin-bottom: 40px;
        }

        /* * NEW: Container for the entire search and preview box
        */
     .search-box-container {
    background: rgba(0, 0, 0, 0.1); /* 90% transparent dark glass */
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    padding: 20px;
    backdrop-filter: blur(5px) saturate(150%);
    -webkit-backdrop-filter: blur(5px) saturate(150%);
    width: 100%;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    position: relative;
    overflow: hidden;
}

/* Optional: very subtle glass shine */
.search-box-container::before {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        120deg,
        rgba(255, 255, 255, 0.03) 0%,  /* faint light streak */
        transparent 100%
    );
    transform: rotate(25deg);
    pointer-events: none;
}

.input-wrapper {
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(0, 0, 0, 0.1); /* 90% transparent */
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 12px 16px;
    backdrop-filter: blur(4px) saturate(140%);
    -webkit-backdrop-filter: blur(4px) saturate(140%);
    transition: all 0.3s ease;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.4);
}



        
        /* * Input Area Styling (Adopted from index.html)
        */
        .input-area-container {
            width: 100%;
            max-width: 580px;
            margin: 0 auto;
        }

        .input-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .toolbar-left, .toolbar-right {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .model-name {
            color: #ccc;
            font-size: 14px;
        }



        .input-wrapper:focus-within {
            border-color: #3b82f6; /* Brighter blue on focus */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        .prompt-input {
            width: 100%;
            background: none;
            border: none;
            outline: none;
            color: #ffffff;
            font-size: 16px;
            font-family: 'Space Grotesk', sans-serif;
        }

        .prompt-input::placeholder {
            color: #666;
        }

        .input-btn {
            width: 36px;
            height: 36px;
            background-color: #222;
            border: 1px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: rgba(255, 255, 255, 0.7);
            flex-shrink: 0;
        }

        .input-btn:hover {
    border-color: cyan;
    box-shadow: 0 0 8px cyan;
    background: #333;  /* keeps a darker hover fill */
    color: #fff;
}

.input-btn:active {
    background-color: #4da6ff; /* light blue fill */
    border-color: #4da6ff;
    color: #000; /* make the '+' icon dark for visibility */
    box-shadow: 0 0 10px rgba(77, 166, 255, 0.7);
}


        .send-btn {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: 1px solid transparent;
    color: white;
    transition: all 0.3s ease;
}

.send-btn:hover {
    border-color: cyan;
    box-shadow: 0 0 8px cyan;
}

.send-btn:active {
    background-color: #4da6ff; /* light blue */
    border-color: #4da6ff;
    color: #000; /* dark text for contrast */
    box-shadow: 0 0 10px rgba(77, 166, 255, 0.7);
}

        
        /* Attachment & Link Preview Styling */
        .attachment-area {
            padding-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .preview-item {
            display: flex;
            align-items: center;
            background-color: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px;
            max-width: 250px;
            position: relative;
        }
        
        .preview-item .preview-thumbnail {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            margin-right: 10px;
            object-fit: cover;
            background-color: #333;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-item .preview-info {
            overflow: hidden;
        }

        .preview-item .preview-name {
            color: #eee;
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .preview-item .preview-details {
            font-size: 12px;
            color: #a0a0a0;
        }

        .preview-close-btn {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #333;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 12px;
            line-height: 18px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Attachment Menu Styling */
        .attachment-container {
            position: relative;
            display: inline-block;
        }

        .attachment-menu {
    position: absolute;      /* positioned by JS near the + button */
    z-index: 9999;           /* on top of the glass box */
    background-color: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    width: 160px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    display: none;           /* start hidden */
    padding: 4px 0;
}


        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            color: #eee;
            padding: 10px 15px;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 14px;
        }

        .menu-item:hover {
            background-color: #333;
        }

        .menu-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            stroke: #a0a0a0;
        }

        /* Modal Styling */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #1a1a1a;
            padding: 25px;
            border: 1px solid #333;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background-color: #111;
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 16px;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #555;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 14px;
            font-weight: 500;
        }

        #submitLinkBtn {
            background-color: #3b82f6;
            color: white;
        }

        #closeModalBtn {
            background-color: #333;
            color: #ccc;
        }


        /* * Adds a subtle glowing effect using a pseudo-element.
        */
        body::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(29, 78, 216, 0.15) 0%, rgba(29, 78, 216, 0) 70%);
            transform: translate(-50%, -50%);
            pointer-events: none;
            animation: pulse 5s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.7; }
        }

        /* * Loader Styling
        */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            transition: opacity 0.5s ease-out;
            opacity: 1;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid #fff;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* * Options container styling
        */
        .options-container {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .option-btn {
            background-color: transparent;
            border: 1px solid #333;
            color: #a0a0a0;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
    border-color: rgb(28, 168, 250);
    box-shadow: 0 0 8px rgb(37, 187, 247);
    color: #fff; /* keep text visible */
}

.option-btn.active {
    background-color: #0f9bec; /* light blue */
    color: #000; /* black text for contrast */
    border-color: #1895e9;
    box-shadow: 0 0 10px rgba(50, 207, 255, 0.7);
}
/* Error Modal matches theme */
#errorModal .modal-content {
    border: 1px solid #333;
    border-radius: 12px;
    background-color: #111;
    color: #fff;
    box-shadow: 0 0 12px cyan;
}

#errorOkBtn {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    border: 1px solid transparent;
    color: white;
    border-radius: 8px;
    padding: 10px 20px;
    transition: all 0.3s ease;
    cursor: pointer;
}
#errorOkBtn:hover {
    border-color: cyan;
    box-shadow: 0 0 8px cyan;
}
#errorOkBtn:active {
    background-color: #4da6ff;
    border-color: #4da6ff;
    color: #000;
    box-shadow: 0 0 10px rgba(77, 166, 255, 0.7);
}
/* Vanta fog container */
#vanta-fog {
    position: fixed;
    inset: 0; /* top:0; right:0; bottom:0; left:0 */
    z-index: 0;
    pointer-events: none;
    opacity: 0.6;
}

/* Add this to your existing <style> tag */

.cta-button {
    display: inline-block;
    padding: 16px 40px;
    margin-top: 30px;
    font-family: 'Orbitron', sans-serif;
    font-size: 18px;
    font-weight: 600;
    color: #ffffff;
    background: linear-gradient(135deg, #42b5eb, #1f58f5);
    border: 2px solid transparent;
    border-radius: 12px;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px rgba(66,181,235,0.5), 0 0 40px rgba(31,88,245,0.3);
    text-transform: uppercase;
    letter-spacing: 2px;
    z-index: 10; /* Make sure it's clickable above fog */
    position: relative;
}

.cta-button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 0 30px rgba(66,181,235,0.8), 0 0 60px rgba(31,88,245,0.6);
    border-color: #42b5eb;
}

.cta-button:active {
    transform: translateY(0);
}
    </style>
</head>
<body>
    <div id="vanta-fog"></div>
    <h2 class="top-header">Misinformation Fighter</h2>

    <div class="background-text">ATLAS</div>

    <div class="container">
        <h1 class="atlas">
  <span>A</span>
  <span>T</span>
  <span>L</span>
  <span>A</span>
  <span>S</span>
</h1>


<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Audiowide&display=swap');

 .atlas {
  font-family: 'Audiowide', 'Orbitron', sans-serif;
  font-size: 3rem;
  display: flex;
  justify-content: center;
  gap: 8px;
  color: #000;
  letter-spacing: 5px;
  text-shadow: 0 0 10px #42b5eb, 0 0 20px #1f58f5;
}

.atlas span {
  display: inline-block;
  transition: transform 0.15s ease, text-shadow 0.2s ease;
}

</style>

         <p class="ai-tagline">Evidence over noise</p>
        <style>
        /* Google Fonts import */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Audiowide&display=swap');

.ai-title {
  font-family: 'Audiowide', sans-serif;
  font-size: 0.5rem;
  background: linear-gradient(90deg, #00f2ff, #7a5cff, #00ff95);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: bold;
  letter-spacing: 2px;
  text-shadow: 0 0 8px rgba(0, 242, 255, 0.5);
  margin: 0;
}

.ai-tagline {
  font-family: 'Orbitron', sans-serif;
  font-size: 1rem;
  color: #b0b8c1;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 6px;
  opacity: 0.85;
}
</style>
        <div class="search-box-container">
            <div class="input-area-container">
                <div id="attachmentArea" class="attachment-area"></div>
                <div class="input-toolbar">
                    <div class="toolbar-left">
                   <div class="attachment-container">
    <button class="input-btn" id="attachBtn" aria-label="Attach file">
       <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14m-7-7h14" />
        </svg>
    </button>
</div>

                    </div>
                    <div class="toolbar-right">
                        <span class="ai-gradient">Ask & Unmask</span>
                          <style>
    .ai-gradient {
      font-family: 'Audiowide', sans-serif;
      background: linear-gradient(90deg, #cad0e6, #76cdf0d8, #c0ced8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: bold;
      letter-spacing: 1px;
    }
  </style>
                        <button class="input-btn send-btn" id="sendBtn" aria-label="Send prompt">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 12h14m-7-7l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="input-wrapper">
                    <input type="text" id="prompt" class="prompt-input" placeholder="Ask anything, or paste a link..." />
                </div>
            </div>
        </div>

        <div class="options-container">
            <button class="option-btn active" data-mode="analytical">Analytical</button>
            <button class="option-btn" data-mode="debate">Debate</button>
        </div>

        <!-- Call to Action Button -->
        <div class="cta-container">
            <a href="/chat" class="cta-button">Start Chatting</a>
        </div>
    </div>

    <div id="loader" class="loader-overlay">
        <div class="spinner"></div>
    </div>
    
    <div id="linkModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Add a Link</h2>
            <input type="text" id="linkInput" placeholder="https://example.com">
            <div class="modal-buttons">
                <button id="closeModalBtn">Cancel</button>
                <button id="submitLinkBtn">Add Link</button>
            </div>
        </div>
    </div>
    <!-- Error Popup Modal -->
<div id="errorModal" class="modal-overlay">
  <div class="modal-content">
    <h2 id="errorMessage"></h2>
    <div class="modal-buttons">
      <button id="errorOkBtn" class="send-btn">Ok</button>
    </div>
  </div>
</div>
 <div class="attachment-menu" id="attachmentMenu">
                                <button class="menu-item" id="uploadFileBtn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                    <span>Upload File</span>
                                </button>
                                <button class="menu-item" id="addLinkBtn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/></svg>
                                    <span>Add Link</span>
                                </button>
                            </div>


    <script>
    // Get the elements from the DOM
        const promptInput = document.getElementById('prompt');
        const loader = document.getElementById('loader');
        const optionButtons = document.querySelectorAll('.option-btn[data-mode]');
        const attachBtn = document.getElementById('attachBtn');
        const attachmentArea = document.getElementById('attachmentArea');
        const sendBtn = document.getElementById('sendBtn');
        const attachmentMenu = document.getElementById('attachmentMenu');
        const uploadFileBtn = document.getElementById('uploadFileBtn');
        const addLinkBtn = document.getElementById('addLinkBtn');
        const linkModal = document.getElementById('linkModal');
        const linkInput = document.getElementById('linkInput');
        const submitLinkBtn = document.getElementById('submitLinkBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');

        let currentMode = 'analytical'; // Default mode
        let attachedFiles = []; // Store multiple attachments

        // Hide the loader on page load and handle back-navigation from cache
        window.addEventListener('pageshow', function(event) {
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 500);
        });

        // Add event listener for mode selection buttons
        optionButtons.forEach(button => {
            button.addEventListener('click', () => {
                optionButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentMode = button.dataset.mode; // Just set the current mode
            });
        });

        
        // Function to create a preview for files or links
        function createAttachmentPreview(file) {
    attachedFiles.push(file);
    const previewId = `preview-${Date.now()}`;

    const previewItem = document.createElement('div');
    previewItem.className = 'preview-item';
    previewItem.id = previewId;

    let thumbnailHTML = '';
    if (file.type && file.type.startsWith('image/')) {
        thumbnailHTML = `<img src="${URL.createObjectURL(file)}" alt="preview" class="preview-thumbnail">`;
    } else if (file.type === 'link') {
        thumbnailHTML = `<div class="preview-thumbnail">🔗</div>`;
    } else {
        thumbnailHTML = `<div class="preview-thumbnail">📄</div>`;
    }

   const fileSize = file.size ? formatFileSize(file.size) : 'Link';
function formatFileSize(bytes) {
    if (bytes === 0) return '0 B';
    const units = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(1024));
    return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + units[i];
}


    previewItem.innerHTML = `
        ${thumbnailHTML}
        <div class="preview-info">
            <div class="preview-name">${file.name}</div>
            <div class="preview-details">${fileSize}</div>
        </div>
        <button class="preview-close-btn" data-preview-id="${previewId}">×</button>
    `;

    attachmentArea.appendChild(previewItem);

    // ❌ remove one preview
    previewItem.querySelector('.preview-close-btn').addEventListener('click', () => {
        previewItem.remove();
        attachedFiles = attachedFiles.filter(f => f !== file);
        updateSendButtonState();
    });

    updateSendButtonState();
}


        // Toggle attachment menu
// Toggle + position attachment menu ABOVE the + button
attachBtn.addEventListener('click', (event) => {
    event.stopPropagation();

    // Temporarily show to measure height
    attachmentMenu.style.display = 'block';
    attachmentMenu.style.visibility = 'hidden';

    const rect = attachBtn.getBoundingClientRect();
    const menuHeight = attachmentMenu.offsetHeight;

    // Position ABOVE the + button (8px gap)
    attachmentMenu.style.top  = `${rect.top + window.scrollY - menuHeight - 8}px`;
    attachmentMenu.style.left = `${rect.left + window.scrollX}px`;

    // Make it visible now
    attachmentMenu.style.visibility = 'visible';
});

// Close the attachment menu if clicking outside of it or the + button
document.addEventListener('click', function(event) {
    // If menu is not visible, do nothing
    if (attachmentMenu.style.display !== 'block') return;
    // If click is inside the menu or on the + button, do nothing
    if (attachmentMenu.contains(event.target) || attachBtn.contains(event.target)) return;
    // Otherwise, hide the menu
    attachmentMenu.style.display = 'none';
});


        // Close menu if clicked outside
       // Handle "Upload File" click
uploadFileBtn.addEventListener('click', () => {
    attachmentMenu.style.display = 'none';
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*,.pdf,.doc,.docx,.txt';
    input.multiple = true; // Allow selecting more than one file

    input.onchange = (e) => {
        const files = Array.from(e.target.files);

        // Check file count limit
        if (attachedFiles.length + files.length > 5) {
            showErrorModal("Sorry, You can upload maximum 5 files");
            return;
        }

        files.forEach(file => {
            // Check file size limit (10 MB = 10 * 1024 * 1024)
            if (file.size > 10 * 1024 * 1024) {
                showErrorModal(`${file.name} - Maximum Size allowed 10MB`);
            } else {
                createAttachmentPreview(file);
            }
        });
    };

    input.click();
});

        // Handle "Add Link" click
        addLinkBtn.addEventListener('click', () => {
            attachmentMenu.style.display = 'none';
            linkModal.style.display = 'flex';
            linkInput.focus();
        });

        // Hide link modal
        function hideLinkModal() {
            linkModal.style.display = 'none';
            linkInput.value = '';
        }

        closeModalBtn.addEventListener('click', hideLinkModal);

        // Handle link submission
        submitLinkBtn.addEventListener('click', () => {
            const url = linkInput.value.trim();
if (isValidUrl(url)) {
    const hostname = new URL(url).hostname;
    const linkFile = { name: hostname, type: 'link', originalUrl: url };
    createAttachmentPreview(linkFile);  // preview shows hostname
    hideLinkModal();
} else {
    alert('Please enter a valid URL.');
}
        });
        // === Error Modal Logic ===
const errorModal = document.getElementById('errorModal');
const errorMessage = document.getElementById('errorMessage');
const errorOkBtn = document.getElementById('errorOkBtn');

function showErrorModal(message) {
    errorMessage.textContent = message;
    errorModal.style.display = 'flex';
}

errorOkBtn.addEventListener('click', () => {
    errorModal.style.display = 'none';
    window.location.href = "./homepage.html"; // reload homepage
});


        // Function to handle form submission
        async function handleSubmit() {
            const promptValue = promptInput.value.trim();

            if (!promptValue && attachedFiles.length === 0) {
                return; // Do nothing if there's no input
            }

            // --- UPDATE: Handle submission based on the selected mode ---

            // For Debate mode, just redirect with the prompt. The index page handles the stream.
            if (currentMode === 'debate') {
                let redirectUrl = `./index.html?mode=debate&prompt=${encodeURIComponent(promptValue)}`;
                // Add any attached file info to the URL as well
                if (attachedFiles.length > 0) {
                    attachedFiles.forEach(file => {
                        if (file.type === 'link') {
                            redirectUrl += `&link=${encodeURIComponent(file.originalUrl || file.name)}`;
                        } else {
                            redirectUrl += `&file=${encodeURIComponent(file.name)}`;
                        }
                    });
                }
                window.location.href = redirectUrl;
                return; // Exit the function
            }

            // For Analytical mode, fetch the data first, then redirect.
            if (currentMode === 'analytical') {
                loader.style.display = 'flex';
                setTimeout(() => loader.style.opacity = '1', 10);

                try {
                    const response = await fetch(`http://127.0.0.1:5000/analyze_topic`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            topic: promptValue,
                            model: "llama3"
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    // Store result in localStorage for the index page to pick up
                    localStorage.setItem("atlas_result", JSON.stringify(data));
                    
                    let redirectUrl = `./index.html?mode=chat&prompt=${encodeURIComponent(promptValue)}`;
                    // Add attachment info to URL
                    if (attachedFiles.length > 0) {
                        attachedFiles.forEach(file => {
                            if (file.type === 'link') {
                                redirectUrl += `&link=${encodeURIComponent(file.originalUrl || file.name)}`;
                            } else {
                                redirectUrl += `&file=${encodeURIComponent(file.name)}`;
                            }
                        });
                    }
                    window.location.href = redirectUrl;

                } catch (error) {
                    console.error("Error calling backend:", error);
                    loader.style.display = 'none';
                    alert("Failed to reach server. Is the backend running?");
                }
            }
        }

        // Add event listener for the send button
        sendBtn.addEventListener('click', handleSubmit);

        // Add event listener for the 'keypress' event on the prompt input
        promptInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent default form submission
                handleSubmit();
            }
        });
        
        // Function to check if a string is a valid URL
        function isValidUrl(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;  
            }
        }
        
        function updateSendButtonState() {
    sendBtn.disabled = (promptInput.value.trim().length === 0) && (attachedFiles.length === 0);
}


        promptInput.addEventListener('input', updateSendButtonState);
        updateSendButtonState();

    </script>
<script>
    const atlasLetters = document.querySelectorAll('.atlas span');

    // Smooth movement variables
    let targetX = 0, targetY = 0;
    let currentX = 0, currentY = 0;
    const lerp = (a, b, n) => a + (b - a) * n;

    document.addEventListener('mousemove', (e) => {
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        targetX = (e.pageX - centerX) / 40;
        targetY = (e.pageY - centerY) / 40;
    });

    function animateAtlas() {
        currentX = lerp(currentX, targetX, 0.12);
        currentY = lerp(currentY, targetY, 0.12);
        atlasLetters.forEach((letter, i) => {
            const delay = (i - atlasLetters.length / 2) * 5;
            const x = currentX + delay;
            const y = currentY;
            letter.style.transform = `translate(${x}px, ${y}px) rotateY(${currentX}deg) rotateX(${-currentY}deg)`;
            letter.style.textShadow = `${currentX}px ${currentY}px 12px #42b5eb, ${-currentX}px ${-currentY}px 24px #1f58f5`;
        });
        requestAnimationFrame(animateAtlas);
    }
    animateAtlas();

    // Reset on mouse leave
    document.addEventListener('mouseleave', () => {
        targetX = 0;
        targetY = 0;
    });
</script>
<!-- three.js (required by Vanta) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

<!-- Vanta Fog -->
<script src="https://cdn.jsdelivr.net/npm/vanta@0.5.24/dist/vanta.fog.min.js"></script>

<script>
  // store the effect instance so you can destroy it later if needed
  let vantaFog = null;

  // Only initialize on larger screens (optional)
  if (window.innerWidth > 480) {
    vantaFog = VANTA.FOG({
      el: "#vanta-fog",
      highlightColor: 0xcfe6ff, // float as hex (0x######)
      midtoneColor: 0x6fa8ff,
      lowlightColor: 0x2f3f6a,
      baseColor: 0x000000,
      speed: 1,   // 0.3..2.5 — larger = faster motion
      zoom: 0.2    // 0.5..1.5 — lower = farther-away fog
      // you can add more options (e.g. mouse controls, etc.)
    });
  }

  // If you ever re-initialize or navigate away, clean up:
  // if (vantaFog) { vantaFog.destroy(); vantaFog = null; }
</script>
</body>
</html>